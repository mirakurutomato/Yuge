<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>弓削商船商船祭 - スケジュール</title>
  <link rel="stylesheet" href="../css/style.css">

  <style>
    #schedulePage{padding:20px 0}

    .page-hero{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:12px 0 20px}
    .page-hero .title{font-size:1.35rem;font-weight:800;color:var(--nav-accent)}
    .page-hero .subtitle{color:var(--muted);font-weight:600}

    .controls{display:flex;gap:12px;align-items:center}
    .search{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;background:rgba(255,255,255,0.9);box-shadow:var(--shadow);border:1px solid rgba(16,32,48,0.04)}
    .search input{border:0;outline:none;background:transparent;font-weight:600}

    .date-filters{display:flex;gap:8px;flex-wrap:wrap}
    .date-filters button{padding:8px 12px;border-radius:999px;border:1px solid rgba(16,32,48,0.04);background:transparent;cursor:pointer;font-weight:700}
    .date-filters button.active{background:linear-gradient(90deg,var(--accentA) 0%, var(--accentC) 100%);color:white;border:none}

    .subtitle .highlight{padding:2px 8px;border-radius:999px;font-weight:900;background:linear-gradient(90deg,var(--accentA),var(--accentC));color:white;margin:0 6px}
    .subtitle-meta{display:inline-block;margin-left:8px;font-weight:600;color:var(--muted);font-size:0.95rem}
    .hint{margin-top:8px;font-size:0.86rem;color:rgba(19,50,68,0.7)}

    .schedule-grid{display:grid;grid-template-columns:280px 1fr;gap:18px;align-items:start;margin-top:8px}

    .dates-list{position:sticky;top:88px;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));box-shadow:var(--shadow);height:max-content}
    .dates-list h4{margin:0 0 8px;color:var(--nav-accent)}
    .dates-list .date-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;cursor:pointer}
    .dates-list .date-item:hover{background:linear-gradient(90deg, rgba(131,58,180,0.06), rgba(252,176,69,0.04))}

    .events-column{display:flex;flex-direction:column;gap:12px}
    .date-group{background:var(--card);padding:14px;border-radius:14px;box-shadow:var(--shadow);border:1px solid rgba(16,32,48,0.03)}
    .date-group .group-header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .group-header .g-title{font-weight:800;color:var(--nav-accent)}
    .group-header .g-info{color:var(--muted);font-weight:700}

    .events-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
    .event-card.custom{padding:12px;border-radius:12px;transition:transform .18s, box-shadow .18s}
    .event-card.custom:hover{transform:translateY(-6px);box-shadow:0 18px 48px rgba(10,20,40,0.12)}
    .event-meta-row{display:flex;gap:10px;align-items:center;color:var(--muted);font-weight:700;font-size:0.95rem}
    .event-desc{margin-top:8px;color:#133244}

    @media(max-width:980px){
      .schedule-grid{grid-template-columns:1fr}
      .events-grid{grid-template-columns:1fr}
      .dates-list{position:relative;top:0}
    }

    @media (max-width: 720px) {
      .page-hero {flex-direction: column;align-items: flex-start;gap: 8px;}
      .search input {width: 100%;}
      .schedule-grid {grid-template-columns: 1fr;gap: 14px;}
      .events-grid {grid-template-columns: 1fr;}
      .date-filters button {padding: 6px 10px;font-size: 0.85rem;}
      .date-item {font-size: 0.9rem;}
    }

    @media (max-width: 480px) {
      .page-hero .title {font-size: 1.2rem;}
      .page-hero .subtitle {font-size: 0.9rem;}
      .search {padding: 6px 8px;}
      .events-column {gap: 10px;}
      .event-card.custom h3 {font-size: 0.95rem;}
      .event-meta-row {flex-direction: column;gap: 4px;font-size: 0.85rem;}
      .date-group {padding: 10px;}
      .date-filters button {padding: 5px 8px;font-size: 0.8rem;}
    }
  </style>
</head>
<body>
  <canvas id="bgCanvas"></canvas>

  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <a class="logo" href="index.html">弓削商船商船祭</a>
      </div>
      <button id="navToggle" class="nav-toggle" aria-label="メニュー切替"><span class="hamburger"></span></button>
      <nav class="nav-links" id="navLinks">
        <a href="index.html">ホーム</a>
        <a href="schedule.html">スケジュール</a>
        <a href="survey.html">アンケート</a>
      </nav>
    </div>
  </header>

  <main class="container" id="schedulePage">
    <section class="page-hero">
      <div>
        <div class="title">スケジュール</div>
        <div class="subtitle">
          <span>イベントを</span>
          <span class="highlight">日付・キーワード</span>
          <span>で絞り込みできます。</span>
          <span class="subtitle-meta">気になるものをチェックしてね！</span>
          <div class="hint">検索のコツ：時間（例 13:00）や会場名（例 "ステージ"）で絞ると早いです。</div>
        </div>
      </div>

      <div class="controls">
        <div class="search" role="search" title="イベント検索">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <input id="searchInput" placeholder="イベント名・時間・会場で検索" aria-label="検索">
        </div>
      </div>

    </section>

    <section style="max-width:var(--maxW);margin:0 auto;padding:0 12px">
      <div class="schedule-grid">
        <aside class="dates-list">
          <h4>日付で絞る</h4>
          <div class="date-filters" id="dateFilters"></div>
          <hr style="border:none;border-top:1px solid rgba(16,32,48,0.04);margin:10px 0">
          <div id="datesListInner"></div>
        </aside>

        <section id="scheduleSection" class="events-column"></section>
      </div>
    </section>
  </main>

  <footer class="site-footer container"><small>&copy; 2025 奥河 董馬（Toma Okugawa）. All Rights Reserved.</small></footer>

  <script src="../js/shared.js"></script>
  <script>
    const events = [
      {date:'2025-11-01', time:'9:00 - 9:30', place:'本部テント横', title:'体験航海 入場券配布', desc:''},
      {date:'2025-11-01', time:'10:00 - 11:00', place:'学校桟橋', title:'体験航海', desc:''},
      {date:'2025-11-01', time:'10:00 - 11:00', place:'ステージ', title:'おいらが歌うしかねぇな（のど自慢）', desc:''},
      {date:'2025-11-01', time:'11:00 - 12:00', place:'ステージ', title:'弓削知ってる界隈（クイズ大会）', desc:''},
      {date:'2025-11-01', time:'13:00 - 14:30', place:'ステージ', title:'軽音ライブ', desc:''},
      {date:'2025-11-01', time:'15:00 - 16:00', place:'ステージ', title:'腕力強いだけじゃダメですか（腕相撲）', desc:''},
      {date:'2025-11-01', time:'16:00 - 17:00', place:'ステージ', title:'弓削ビジュいいじゃん（コスプレ大会）', desc:''},
      {date:'2025-11-02', time:'10:00 - 10:30', place:'ステージ', title:'吹奏楽部演奏', desc:''},
      {date:'2025-11-02', time:'11:00 - 12:00', place:'ステージ', title:'ｴｯﾎｴｯﾎ早食いするって伝えなきゃ（早食い）', desc:''},
      {date:'2025-11-02', time:'11:30 - 12:00', place:'本部テント横', title:'体験航海 入場券配布', desc:''},
      {date:'2025-11-02', time:'12:00 - 13:00', place:'学校桟橋', title:'体験航海', desc:''},
      {date:'2025-11-02', time:'13:00 - 14:30', place:'ステージ', title:'軽音ライブ', desc:''},
      {date:'2025-11-02', time:'15:00 - 16:00', place:'ステージ', title:'抽選会', desc:''}
    ];

    function formatDateJapanese(dateStr){
      const d = new Date(dateStr + 'T00:00:00');
      const opts = { month: 'numeric', day: 'numeric', weekday: 'short' };
      return new Intl.DateTimeFormat('ja-JP', opts).format(d);
    }

    function groupByDate(arr){
      return arr.reduce((acc, ev) => {
        (acc[ev.date] = acc[ev.date] || []).push(ev);
        return acc;
      }, {});
    }

    const scheduleSection = document.getElementById('scheduleSection');
    const dateFilters = document.getElementById('dateFilters');
    const datesListInner = document.getElementById('datesListInner');
    const searchInput = document.getElementById('searchInput');

    let activeDate = null;
    let filteredEvents = [...events];

    function render(){
      const grouped = groupByDate(filteredEvents);
      const dates = Object.keys(groupByDate(events)).sort();
      dateFilters.innerHTML = '';
      const allBtn = document.createElement('button');
      allBtn.textContent = 'すべて';
      allBtn.className = activeDate === null ? 'active' : '';
      allBtn.onclick = () => { activeDate = null; applyFilters(); };
      dateFilters.appendChild(allBtn);

      dates.forEach(d => {
        const btn = document.createElement('button');
        btn.textContent = formatDateJapanese(d);
        btn.className = (activeDate === d) ? 'active' : '';
        btn.onclick = () => { activeDate = d; applyFilters(); };
        dateFilters.appendChild(btn);
      });

      datesListInner.innerHTML = '';
      dates.forEach(d => {
        const item = document.createElement('div');
        item.className = 'date-item';
        item.innerHTML = `<div style="font-weight:800">${formatDateJapanese(d)}</div><div style="color:var(--muted)">${(groupByDate(events)[d]||[]).length}</div>`;
        item.onclick = () => { activeDate = d; applyFilters(); window.scrollTo({top:0,behavior:'smooth'}); };
        datesListInner.appendChild(item);
      });

      scheduleSection.innerHTML = '';
      const sortedDates = Object.keys(grouped).sort();
      if(sortedDates.length === 0){
        const empty = document.createElement('div');
        empty.className = 'poster-placeholder';
        empty.innerHTML = `<div class="placeholder-inner"><div class="placeholder-title">該当するイベントはありません</div><div class="placeholder-sub">検索キーワードや日付フィルターを変えてみてください。</div></div>`;
        scheduleSection.appendChild(empty);
        return;
      }

      sortedDates.forEach(d => {
        const group = document.createElement('div');
        group.className = 'date-group';
        const header = document.createElement('div');
        header.className = 'group-header';
        header.innerHTML = `<div class="g-title">${formatDateJapanese(d)}</div><div class="g-info">${grouped[d].length} 件</div>`;
        group.appendChild(header);

        const grid = document.createElement('div');
        grid.className = 'events-grid';

        const parseStartMinutes = t => {
          if(!t) return 0;
          const part = (t.split('-')[0] || '').trim();
          const [hStr, mStr] = (part.split(':').map(s => s.trim()));
          const h = Number(hStr || 0);
          const m = Number(mStr || 0);
          if(Number.isNaN(h) || Number.isNaN(m)) return 0;
          return h * 60 + m;
        };

        grouped[d].sort((a, b) => parseStartMinutes(a.time) - parseStartMinutes(b.time)).forEach(ev => {
          const card = document.createElement('article');
          card.className = 'event-card custom';
          card.innerHTML = `
            <h3 style="margin:0 0 6px;color:var(--accentA);font-size:1.02rem">${ev.title}</h3>
            <div class="event-meta-row">
              <div title="時間">⏰ ${ev.time}</div>
              <div title="場所">📍 ${ev.place}</div>
            </div>
            <p class="event-desc">${ev.desc}</p>
          `;
          grid.appendChild(card);
        });

        group.appendChild(grid);
        scheduleSection.appendChild(group);
      });
    }

    function applyFilters(){
      const q = (searchInput.value || '').trim().toLowerCase();
      filteredEvents = events.filter(ev => {
        if(activeDate && ev.date !== activeDate) return false;
        if(!q) return true;
        return ([ev.title, ev.place, ev.time, ev.desc].join(' ')).toLowerCase().includes(q);
      });
      render();
    }

    searchInput.addEventListener('input', ()=>{ applyFilters(); });

    render();

    document.getElementById('navToggle').addEventListener('click', ()=>{
      document.getElementById('navLinks').classList.toggle('show');
    });
  </script>
</body>
</html>
